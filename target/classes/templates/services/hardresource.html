<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/web/thymeleaf/layout">
<head>
<meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>创建硬件资源</title>
<link rel="stylesheet" type="text/css"
	href="../../css/bootstrap.min.css" />
<link rel="stylesheet" type="text/css"
	href="../../css/font-awesome.min.css" />
<script type="text/javascript" src="../../js/jquery-1.10.2.min.js"></script>
<script type="text/javascript" src="../../js/bootstrap.min.js"></script>
<script type="text/javascript" src="../../js/xlsx.core.min.js"></script>
</head>
<body>
	<div class="container">
		<div class="page-header">
			<h1>硬资源发布</h1>
		</div>
		<ul class="nav nav-tabs nav-justified">
			<li role="presentation" class="active"><a href="#resource-form"
				data-toggle="tab"><b>表格填写发布</b></a></li>
			<li role="presentation"><a href="#resource-file"
				data-toggle="tab"><b>文件上传发布</b></a></li>
		</ul>
		<div class="container-fuild tab-content" style="margin-top: 20px;">
			<div class="tab-pane fade in active" id="resource-form">
				<div class="col-sm-12 col-md-12">
					<form th:action="@{/services/hardresource/formcreate}"
						th:object="${hardresource}" method="post">
						<div class="form-group">
							<label for="name">服务名称</label>
							<div class="input-group">
								<input type="text" class="form-control" name="InputName"
									id="InputName" th:field="*{name}" placeholder="Enter Name" /> <span
									class="input-group-addon"> <span
									class="glyphicon glyphicon-asterisk"></span>
								</span>
							</div>
						</div>
						<div class="form-group">
							<label for="deviceowner">设备管理者</label>
							<div class="input-group">
								<input type="text" class="form-control" name="InputDeviceOwner"
									id="InputDeviceOwner" th:field="*{deviceOwner}"
									placeholder="Enter Owner" /> <span class="input-group-addon">
									<span class="glyphicon glyphicon-asterisk"></span>
								</span>
							</div>
						</div>
						<div class="form-group">
							<label for="deviceCode">设备编号</label>
							<div class="input-group">
								<input type="text" class="form-control" name="InputDevicecode"
									id="InputDevicecode" th:field="*{deviceCode}"
									placeholder="Enter Devicecode" /> <span
									class="input-group-addon"> <span
									class="glyphicon glyphicon-asterisk"></span>
								</span>
							</div>
						</div>
						<div class="form-group">
							<label for="deviceCategory">所属类别</label>
							<div class="input-group">
								<input type="text" class="form-control"
									name="InputDeviceCategory" id="InputDeviceCategory"
									th:field="*{deviceCategory}" placeholder="Enter Category" /> <span
									class="input-group-addon"> <span
									class="glyphicon glyphicon-asterisk"></span>
								</span>
							</div>
						</div>
						<div class="form-group">
							<label for="productionDate">生产日期</label>
							<div class="input-group">
								<input type="date" class="form-control"
									name="InputProductiondate" id="InputProductiondate"
									th:field="*{productionDate}"
									placeholder="Enter Production Date" /> <span
									class="input-group-addon"> <span
									class="glyphicon glyphicon-asterisk"></span>
								</span>
							</div>
						</div>
						<div class="form-group">
							<label for="operationDays">运营时间</label>
							<div class="input-group">
								<input type="text" class="form-control"
									name="InputOperationDays" id="InputOperationDays"
									th:field="*{operationDays}" placeholder="Enter Operation Days" />
								<span class="input-group-addon"> <span
									class="glyphicon glyphicon-asterisk"></span>
								</span>
							</div>
						</div>
						<div class="form-group">
							<label for="functionName">功能名称</label>
							<div class="input-group">
								<input type="text" class="form-control" name="InputFunctionName"
									id="InputFunctionName" th:field="*{functionName}"
									placeholder="Enter Function Name" /> <span
									class="input-group-addon"> <span
									class="glyphicon glyphicon-asterisk"></span>
								</span>
							</div>
						</div>
						<div class="form-group">
							<label for="functionDescription">功能描述</label>
							<div class="input-group">
								<textarea name="InputFunctionDescription"
									id="InputFunctionDescription" class="form-control" rows="3"
									th:field="*{functionDescription}">
								</textarea>
								<span class="input-group-addon"> <span
									class="glyphicon glyphicon-asterisk"></span>
								</span>
							</div>
						</div>
						<div class="form-group">
							<label for="description">资源描述</label>
							<div class="input-group">
								<textarea name="InputDescription" id="InputDescription"
									class="form-control" rows="3" th:field="*{description}">
								</textarea>
								<span class="input-group-addon"> <span
									class="glyphicon glyphicon-asterisk"></span>
								</span>
							</div>
						</div>
						<input type="submit" name="submit" id="submit" value="提交"
							class="btn btn-lg btn-info pull-right" />
					</form>
				</div>
			</div>
			<div class="tab-pane fade" id="resource-file">
				<div class="col-sm-12 col-md-12">
					<form th:action="@{/services/filecreate}"
							th:object="${hardresource}" method="post">
						<div class="form-group">
							<label for="fileCategory">选择描述文件类型</label>
							<div class="form-group">
								<select class="form-control" id="fileCategory">
									<option>rdf/xml</option>
									<option>xlsx</option>
									<option>rdf/json</option>
								</select>
							</div>
							<label for="description">描述文件</label>
							<input type="file" id="files" name="file"/>
							<output id="list"></output>
						</div>
						<div class="container" id="file_content" 
							style="height: 200px; overflow-y: auto; overflow-x: hidden; border:1px;
							margin-bottom:10px; border-color:#ddd;">
						</div>
						<input type="submit" class="btn btn-info" name="submit"
							id="publishService" value="发布服务"/>
					</form>
				</div>
			</div>
		</div>
	</div>
</body>
<script>
	function handleFileSelect(evt) {
	    var files = evt.target.files; // FileList object	
	    // files is a FileList of File objects. List some properties.
	    var output = [];
	    for (var i = 0, f; f = files[i]; i++) {
	      output.push('<li>',f.size, ' bytes, last modified: ',
	                  f.lastModifiedDate ? f.lastModifiedDate.toLocaleDateString() : 'n/a', '</li>');
	    }
	    document.getElementById('list').innerHTML = '<ul>' + output.join('') + '</ul>';
	}
	document.getElementById('files').addEventListener('change', handleFileSelect, false);

	$(function(){
        $('#files').change(function(e) {
            var files = e.target.files;
            var fileReader = new FileReader();
            fileReader.onload = function(ev) {
                try {
                    var data = ev.target.result,
                        workbook = XLSX.read(data, {
                            type: 'binary'
                        }), // 以二进制流方式读取得到整份excel表格对象
                        items = []; // 存储获取到的数据
                } catch (e) {
                    console.log('文件类型不正确');
                    return;
                }
                // 遍历每张表读取
                for (var sheet in workbook.Sheets) {
                    if (workbook.Sheets.hasOwnProperty(sheet)) {
                        items = items.concat(XLSX.utils.sheet_to_json(workbook.Sheets[sheet]));
                        break;//只取第一个Sheets
                    }
                }
                print_data(items);
            };
            fileReader.readAsBinaryString(files[0]);// 以二进制方式打开文件
        });
    });

    //处理格式化后的json数据
    function print_data(data){
        $.each(data, function(key,val){
            console.log(val.表头1);
            $.each(val, function(k,v){
                console.log(k + "  ->  " + v);
            });
        });
        var output = JSON.stringify(data);
        document.getElementById('file_content').innerText = output;
    }
    var upload_data = document.getElementById('file_content').innerText;
    //上传json
    function uploadFile() {
    	var files = document.getElementById('files').files;
    	var form = $('#files')[0];
        var data = new FormData(form);
        data.append("CustomField", "This is some extra data, testing");
    	$.ajax({
        	method:"post",
        	url:"/hardresource/filecreate",
        	data:data,
        	success:function(data){
        	    //do something with data.
        	}
        });
    }
    $(document).ready(function () {
        $("#publishService1").click(function (event) {
            //stop submit the form, we will post it manually.
            event.preventDefault();

            uploadFile(upload_data);

        });

    });
</script>
</html>